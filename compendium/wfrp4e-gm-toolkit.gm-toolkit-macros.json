{
	"label": "GM Toolkit",
    "folders": {
        "Toolboxes": "Cajas de herramientas"
    },
	"entries": [
		{
			"id": "Canvas Toolbox",
			"name": "Caja de herramientas del Lienzo",
			"command": "const title = \"GM Toolkit - Caja de herramientas del Lienzo\"\n\nconst macros = [\n  // \"Añadir Ventaja\",\n  // \"Elimiar Ventaja\",\n  // \"Reducir Ventaja\",\n  // \"Comprobar Estados\",\n  // \"Fin de la sesión\",\n  // \"Añadir PX\",\n  // \"Reiniciar Fortuna\",\n  // \"Iniciar consola de Daño\",\n  // \"Realizar Chequeo de grupo secreto\",\n  // \"Enviar susurros oscuros\",\n  \"Conmutar visiblidad de compendios\",\n  \"Establecer visión y luz de la ficha\",\n  \"Mover a todo el mundo a la Escena\",\n  \"Cambiar Escena a yardas\",\n  // \"Simplemente d100\",\n  // \"Conmutar visiblidad de compendios\"\n]\n\nconst settings = [\n  // \"advantage\",\n  // \"darkwhispers\",\n  // \"grouptest\",\n  // \"session\",\n  \"vision\",\n  // \"maintenance\"\n]\n\n\nclass QuickMenu extends HandlebarsApplicationMixin(ApplicationV2) {\n  static DEFAULT_OPTIONS = {\n    tag: \"form\",\n    form: {\n      handler: QuickMenu.formHandler,\n      submitOnChange: false,\n      closeOnSubmit: false\n    },\n    position: { width: 350 },\n    window: { title: title }\n  }\n\n  static PARTS = {\n    form: {\n      template: \"/modules/wfrp4e-gm-toolkit/templates/quickmenu.hbs\"\n    }\n  }\n\n  async _prepareContext () {\n    const quickMenu = []\n    buildMacroMenu()\n    buildSettingsMenu()\n    return { quickMenu }\n\n    // Build Macro quick menu buttons\n    function buildMacroMenu () {\n      if (macros.length > 0) {\n        for (const macro of macros) {\n          const name = macro.trim()\n          if (!game.macros.getName(name)) continue\n\n          const label = (game.i18n.localize(game.gmtoolkit.utility.strip(name, \"GMTOOLKIT.Macro\", \".\"))\n            === game.gmtoolkit.utility.strip(name, \"GMTOOLKIT.Macro\", \".\"))\n            ? name\n            : game.i18n.localize(game.gmtoolkit.utility.strip(name, \"GMTOOLKIT.Macro\", \".\"))\n\n          const icon = game.macros.getName(name)?.img\n\n          quickMenu.push({\n            name: name,\n            label: label,\n            icon: icon,\n            action: \"macro\"\n          })\n        }\n      }\n    }\n\n    // Build Settings quick menu buttons\n    function buildSettingsMenu () {\n      if (settings.length > 0) {\n        const root = \"game.gmtoolkit.settings.\"\n        for (const setting of settings) {\n          const name = setting.trim()\n          const path = root + name\n          try {\n            eval(`new ${path}()`)\n          } catch(e) {\n            console.error(`GM Toolkit: Quick Menu - ${name} is not a valid settings app`)\n            continue\n          }\n          const settingsApp = eval(`new ${path}()`)\n          const label = game.i18n.localize(settingsApp?.title)\n\n          quickMenu.push({\n            name: name,\n            label: label,\n            // icon: \"modules/wfrp4e-gm-toolkit/assets/icons/quick-settings.svg\",\n            action: \"setting\"\n          })\n        }\n      }\n    }\n  }\n\n  static async formHandler (event, form, formData) {\n    if (event.submitter.dataset.action === \"macro\") {\n      game.macros.getName(event.submitter.dataset.name).execute()\n    }\n    if (event.submitter.dataset.action === \"setting\") {\n      new game.gmtoolkit.settings[event.submitter.dataset.name]().render(true)\n    }\n  }\n\n}\n\nnew QuickMenu().render({ force: true })\n\n\n/* ==========\n* MACRO: GM Toolbox\n* VERSION: 9.0.0\n* UPDATED: 2025-05-17\n* DESCRIPTION: Adds a customisable floating dialog for quick access to frequently used Toolkit macros, freeing up hotbar spots\n* TIP: Add / remove macros from the 'macros' list to tailor it for your game. Names must exactly match those in the Macro Directory.\n* TIP: The macro dialog can be kept open for quick access and minimised to reduce space\n========== */"
		},
		{
			"id": "Combat Toolbox",
			"name": "Caja de herramientas del Combate",
			"command": "const title = \"GM Toolkit - Caja de herramientas del Combate\"\n\nconst macros = [\n  \"Añadir Ventaja\",\n  \"Elimiar Ventaja\",\n  \"Reducir Ventaja\",\n  \"Comprobar Estados\",\n  // \"Fin de la sesión\",\n  // \"Añadir PX\",\n  // \"Reiniciar Fortuna\",\n  \"Iniciar consola de Daño\",\n  // \"Realizar Chequeo de grupo secreto\",\n  // \"Enviar susurros oscuros\",\n  // \"Conmutar visiblidad de compendios\",\n  // \"Establecer visión y luz de la ficha\",\n  // \"Mover a todo el mundo a la Escena\",\n  // \"Cambiar Escena a yardas\",\n  \"Simplemente d100\",\n  // \"Conmutar visiblidad de compendios\"\n]\n\nconst settings = [\n  \"advantage\",\n  // \"darkwhispers\",\n  // \"grouptest\",\n  // \"session\",\n  // \"vision\",\n  // \"maintenance\"\n]\n\n\nclass QuickMenu extends HandlebarsApplicationMixin(ApplicationV2) {\n  static DEFAULT_OPTIONS = {\n    tag: \"form\",\n    form: {\n      handler: QuickMenu.formHandler,\n      submitOnChange: false,\n      closeOnSubmit: false\n    },\n    position: { width: 350 },\n    window: { title: title }\n  }\n\n  static PARTS = {\n    form: {\n      template: \"/modules/wfrp4e-gm-toolkit/templates/quickmenu.hbs\"\n    }\n  }\n\n  async _prepareContext () {\n    const quickMenu = []\n    buildMacroMenu()\n    buildSettingsMenu()\n    return { quickMenu }\n\n    // Build Macro quick menu buttons\n    function buildMacroMenu () {\n      if (macros.length > 0) {\n        for (const macro of macros) {\n          const name = macro.trim()\n          if (!game.macros.getName(_id)) continue\n\n          const label = (game.i18n.localize(game.gmtoolkit.utility.strip(name, \"GMTOOLKIT.Macro\", \".\"))\n            === game.gmtoolkit.utility.strip(name, \"GMTOOLKIT.Macro\", \".\"))\n            ? name\n            : game.i18n.localize(game.gmtoolkit.utility.strip(name, \"GMTOOLKIT.Macro\", \".\"))\n\n          const icon = game.macros.getName(name)?.img\n\n          quickMenu.push({\n            name: name,\n            label: label,\n            icon: icon,\n            action: \"macro\"\n          })\n        }\n      }\n    }\n\n    // Build Settings quick menu buttons\n    function buildSettingsMenu () {\n      if (settings.length > 0) {\n        const root = \"game.gmtoolkit.settings.\"\n        for (const setting of settings) {\n          const name = setting.trim()\n          const path = root + name\n          try {\n            eval(`new ${path}()`)\n          } catch(e) {\n            console.error(`GM Toolkit: Quick Menu - ${name} is not a valid settings app`)\n            continue\n          }\n          const settingsApp = eval(`new ${path}()`)\n          const label = game.i18n.localize(settingsApp?.title)\n\n          quickMenu.push({\n            name: name,\n            label: label,\n            // icon: \"modules/wfrp4e-gm-toolkit/assets/icons/quick-settings.svg\",\n            action: \"setting\"\n          })\n        }\n      }\n    }\n  }\n\n  static async formHandler (event, form, formData) {\n    if (event.submitter.dataset.action === \"macro\") {\n      game.macros.getName(event.submitter.dataset.name).execute()\n    }\n    if (event.submitter.dataset.action === \"setting\") {\n      new game.gmtoolkit.settings[event.submitter.dataset.name]().render(true)\n    }\n  }\n\n}\n\nnew QuickMenu().render({ force: true })\n\n\n/* ==========\n* MACRO: GM Toolbox\n* VERSION: 9.0.0\n* UPDATED: 2025-05-17\n* DESCRIPTION: Adds a customisable floating dialog for quick access to frequently used Toolkit macros, freeing up hotbar spots\n* TIP: Add / remove macros from the 'macros' list to tailor it for your game. Names must exactly match those in the Macro Directory.\n* TIP: The macro dialog can be kept open for quick access and minimised to reduce space\n========== */"
		},
		{
			"id": "GM Toolbox",
			"name": "Caja de herramientas del DJ",
			"command": "const title = \"Caja de herramientas del DJ\"\n\nconst macros = [\n  \"Añadir Ventaja\",\n  \"Elimiar Ventaja\",\n  \"Reducir Ventaja\",\n  \"Comprobar Estados\",\n  \"Fin de la sesión\",\n  \"Añadir PX\",\n  \"Reiniciar Fortuna\",\n  \"Iniciar consola de Daño\",\n  \"Realizar Chequeo de grupo secreto\",\n  \"Enviar susurros oscuros\",\n  \"Conmutar visiblidad de compendios\",\n  \"Establecer visión y luz de la ficha\",\n  \"Mover a todo el mundo a la Escena\",\n  \"Cambiar Escena a yardas\",\n  \"Simplemente d100\",\n  \"Conmutar visiblidad de compendios\"\n]\n\nconst settings = [\n  // \"advantage\",\n  // \"darkwhispers\",\n  // \"grouptest\",\n  // \"session\",\n  // \"vision\",\n  // \"maintenance\"\n]\n\n\nclass QuickMenu extends HandlebarsApplicationMixin(ApplicationV2) {\n  static DEFAULT_OPTIONS = {\n    tag: \"form\",\n    form: {\n      handler: QuickMenu.formHandler,\n      submitOnChange: false,\n      closeOnSubmit: false\n    },\n    position: { width: 350 },\n    window: { title: title }\n  }\n\n  static PARTS = {\n    form: {\n      template: \"/modules/wfrp4e-gm-toolkit/templates/quickmenu.hbs\"\n    }\n  }\n\n  async _prepareContext () {\n    const quickMenu = []\n    buildMacroMenu()\n    buildSettingsMenu()\n    return { quickMenu }\n\n    // Build Macro quick menu buttons\n    function buildMacroMenu () {\n      if (macros.length > 0) {\n        for (const macro of macros) {\n          const name = macro.trim()\n          if (!game.macros.getName(name)) continue\n\n          const label = (game.i18n.localize(game.gmtoolkit.utility.strip(name, \"GMTOOLKIT.Macro\", \".\"))\n            === game.gmtoolkit.utility.strip(name, \"GMTOOLKIT.Macro\", \".\"))\n            ? name\n            : game.i18n.localize(game.gmtoolkit.utility.strip(name, \"GMTOOLKIT.Macro\", \".\"))\n\n          const icon = game.macros.getName(name)?.img\n\n          quickMenu.push({\n            name: name,\n            label: label,\n            icon: icon,\n            action: \"macro\"\n          })\n        }\n      }\n    }\n\n    // Build Settings quick menu buttons\n    function buildSettingsMenu () {\n      if (settings.length > 0) {\n        const root = \"game.gmtoolkit.settings.\"\n        for (const setting of settings) {\n          const name = setting.trim()\n          const path = root + name\n          try {\n            eval(`new ${path}()`)\n          } catch(e) {\n            console.error(`GM Toolkit: Quick Menu - ${name} is not a valid settings app`)\n            continue\n          }\n          const settingsApp = eval(`new ${path}()`)\n          const label = game.i18n.localize(settingsApp?.title)\n\n          quickMenu.push({\n            name: name,\n            label: label,\n            // icon: \"modules/wfrp4e-gm-toolkit/assets/icons/quick-settings.svg\",\n            action: \"setting\"\n          })\n        }\n      }\n    }\n  }\n\n  static async formHandler (event, form, formData) {\n    if (event.submitter.dataset.action === \"macro\") {\n      game.macros.getName(event.submitter.dataset.name).execute()\n    }\n    if (event.submitter.dataset.action === \"setting\") {\n      new game.gmtoolkit.settings[event.submitter.dataset.name]().render(true)\n    }\n  }\n\n}\n\nnew QuickMenu().render({ force: true })\n\n\n/* ==========\n* MACRO: GM Toolbox\n* VERSION: 9.0.0\n* UPDATED: 2025-05-17\n* DESCRIPTION: Adds a customisable floating dialog for quick access to frequently used Toolkit macros, freeing up hotbar spots\n* TIP: Add / remove macros from the 'macros' list to tailor it for your game. Names must exactly match those in the Macro Directory.\n* TIP: The macro dialog can be kept open for quick access and minimised to reduce space\n========== */"
		},
		{
			"id": "GM Toolkit Settings",
			"name": "Ajustes de GM Toolkit"
		},
		{
			"id": "Session Toolbox",
			"name": "Caja de herramientas de la Sesión",
			"command": "const title = \"GM Toolkit - Caja de herramientas de la Sesión\"\n\nconst macros = [\n  // \"Añadir Ventaja\",\n  // \"Elimiar Ventaja\",\n  // \"Reducir Ventaja\",\n  // \"Comprobar Estados\",\n  \"Iniciar consola de Daño\",\n  \"Realizar Chequeo de grupo secreto\",\n  \"Enviar susurros oscuros\",\n  // \"Conmutar visiblidad de compendios\",\n  \"Mover a todo el mundo a la Escena\",\n  \"Establecer visión y luz de la ficha\",\n  // \"Cambiar Escena a yardas\",\n  \"Fin de la sesión\",\n  // \"Añadir PX\",\n  // \"Reiniciar Fortuna\",\n  \"Simplemente d100\",\n  // \"Conmutar visiblidad de compendios\"\n]\n\nconst settings = [\n  // \"advantage\",\n  \"darkwhispers\",\n  \"grouptest\",\n  \"session\",\n  // \"vision\",\n  // \"maintenance\"\n]\n\n\nclass QuickMenu extends HandlebarsApplicationMixin(ApplicationV2) {\n  static DEFAULT_OPTIONS = {\n    tag: \"form\",\n    form: {\n      handler: QuickMenu.formHandler,\n      submitOnChange: false,\n      closeOnSubmit: false\n    },\n    position: { width: 350 },\n    window: { title: title }\n  }\n\n  static PARTS = {\n    form: {\n      template: \"/modules/wfrp4e-gm-toolkit/templates/quickmenu.hbs\"\n    }\n  }\n\n  async _prepareContext () {\n    const quickMenu = []\n    buildMacroMenu()\n    buildSettingsMenu()\n    return { quickMenu }\n\n    // Build Macro quick menu buttons\n    function buildMacroMenu () {\n      if (macros.length > 0) {\n        for (const macro of macros) {\n          const name = macro.trim()\n          if (!game.macros.getName(name)) continue\n\n          const label = (game.i18n.localize(game.gmtoolkit.utility.strip(name, \"GMTOOLKIT.Macro\", \".\"))\n            === game.gmtoolkit.utility.strip(name, \"GMTOOLKIT.Macro\", \".\"))\n            ? name\n            : game.i18n.localize(game.gmtoolkit.utility.strip(name, \"GMTOOLKIT.Macro\", \".\"))\n\n          const icon = game.macros.getName(name)?.img\n\n          quickMenu.push({\n            name: name,\n            label: label,\n            icon: icon,\n            action: \"macro\"\n          })\n        }\n      }\n    }\n\n    // Build Settings quick menu buttons\n    function buildSettingsMenu () {\n      if (settings.length > 0) {\n        const root = \"game.gmtoolkit.settings.\"\n        for (const setting of settings) {\n          const name = setting.trim()\n          const path = root + name\n          try {\n            eval(`new ${path}()`)\n          } catch(e) {\n            console.error(`GM Toolkit: Quick Menu - ${name} is not a valid settings app`)\n            continue\n          }\n          const settingsApp = eval(`new ${path}()`)\n          const label = game.i18n.localize(settingsApp?.title)\n\n          quickMenu.push({\n            name: name,\n            label: label,\n            // icon: \"modules/wfrp4e-gm-toolkit/assets/icons/quick-settings.svg\",\n            action: \"setting\"\n          })\n        }\n      }\n    }\n  }\n\n  static async formHandler (event, form, formData) {\n    if (event.submitter.dataset.action === \"macro\") {\n      game.macros.getName(event.submitter.dataset.name).execute()\n    }\n    if (event.submitter.dataset.action === \"setting\") {\n      new game.gmtoolkit.settings[event.submitter.dataset.name]().render(true)\n    }\n  }\n\n}\n\nnew QuickMenu().render({ force: true })\n\n\n/* ==========\n* MACRO: GM Toolbox\n* VERSION: 9.0.0\n* UPDATED: 2025-05-17\n* DESCRIPTION: Adds a customisable floating dialog for quick access to frequently used Toolkit macros, freeing up hotbar spots\n* TIP: Add / remove macros from the 'macros' list to tailor it for your game. Names must exactly match those in the Macro Directory.\n* TIP: The macro dialog can be kept open for quick access and minimised to reduce space\n========== */"
		},
		{
			"id": "Add Advantage",
			"name": "Añadir Ventaja"
		},
		{
			"id": "Add XP",
			"name": "Añadir PX"
		},
		{
			"id": "Change Scene to Yards",
			"name": "Cambiar Escena a yardas"
		},
		{
			"id": "Check Conditions",
			"name": "Comprobar Estados"
		},
		{
			"id": "Clear Advantage",
			"name": "Elimiar Ventaja"
		},
		{
			"id": "Launch Damage Console",
			"name": "Iniciar consola de Daño"
		},
		{
			"id": "Make Secret Group Test",
			"name": "Realizar Chequeo de grupo secreto"
		},
		{
			"id": "Pull Everyone to Scene",
			"name": "Mover a todo el mundo a la Escena"
		},
		{
			"id": "Reduce Advantage",
			"name": "Reducir Ventaja"
		},
		{
			"id": "Reset Fortune",
			"name": "Reiniciar Fortuna"
		},
		{
			"id": "Send Dark Whispers",
			"name": "Enviar susurros oscuros"
		},
		{
			"id": "Session Turnover",
			"name": "Fin de la sesión",
			"command": "endSession()\n\nasync function endSession () {\n  if (!game.user.isGM) {\n    return ui.notifications.error(game.i18n.localize(\"GMTOOLKIT.Message.SessionEnd.NoPermission\"), {})\n  }\n\n  game.gmtoolkit.module.log(false, \"Processing Session Turnover.\")\n\n  game.gmtoolkit.module.log(false, \"Pausing game.\")\n  await game.togglePause(pause = true, push = true)\n\n  game.gmtoolkit.module.log(false, \"Switching to holding scene.\")\n  game.scenes.getName(game.settings.get(\"wfrp4e-gm-toolkit\", \"holdingScene\"))?.activate(true)\n\n  game.gmtoolkit.module.log(false, \"Adding Experience.\")\n  await game.macros.getName(\"Añadir PX\").execute()\n\n  game.gmtoolkit.module.log(false, \"Resetting Fortune.\")\n  await game.macros.getName(\"Reiniciar Fortuna\").execute()\n\n  game.gmtoolkit.module.log(false, \"Exporting Chat.\")\n  if (game.settings.get(\"wfrp4e-gm-toolkit\", \"exportChat\")) {\n    await game.messages.export()\n  }\n\n  if (game.settings.get(\"wfrp4e-gm-toolkit\", \"sessionID\") === \"null\") {\n    game.gmtoolkit.module.log(false, \"Not updating Session ID.\")\n  } else {\n    game.gmtoolkit.module.log(false, \"Updating Session ID.\")\n    const thisSession = game.gmtoolkit.utility.getSession().id\n    let nextSession = Math.trunc(thisSession) === Number(thisSession)\n      ? Number(thisSession) + 1\n      : thisSession\n\n    foundry.applications.api.DialogV2.wait({\n      window: { title: game.i18n.localize(\"GMTOOLKIT.Dialog.SessionTurnover.UpdateSessionID.Title\") },\n      rejectClose: false,\n      content: `<form>\n            <p>${game.i18n.format(\"GMTOOLKIT.Dialog.SessionTurnover.UpdateSessionID.CurrentSession\", { thisSession })}</p>\n            <div class=\"form-group\">\n            <p>${game.i18n.localize(\"GMTOOLKIT.Dialog.SessionTurnover.UpdateSessionID.NextSession\")}</p> \n            <input type=\"text\" id=\"nextsession\" name=\"nextsession\" value=\"${nextSession}\" />\n            </div>\n            </form>`,\n      buttons: [\n        {\n          icon: \"<i class='fas fa-check'></i>\",\n          label: game.i18n.localize(\"GMTOOLKIT.Dialog.Apply\"),\n          action: \"apply\",\n          callback: (event, button, dialog) => {\n            result = new foundry.applications.ux\n              .FormDataExtended(button.form).object\n            nextSession = result.nextsession\n            game.settings.set(\"wfrp4e-gm-toolkit\", \"sessionID\", nextSession)\n            game.gmtoolkit.module.log(true, `Previous Session ID was ${thisSession}. Next Session ID is ${nextSession}.`)\n          }\n        },\n        {\n          icon: \"<i class='fas fa-times'></i>\",\n          label: game.i18n.localize(\"GMTOOLKIT.Dialog.Cancel\"),\n          action: \"cancel\"\n        }\n      ]\n    })\n  } // End Session ID Update\n\n  game.gmtoolkit.module.log(false, \"Completed Session Turnover tasks.\")\n}\n\n/* ==========\n * MACRO: Session Turnover\n * VERSION: 9.0.0\n * UPDATED: 2025-05-11\n * DESCRIPTION: Unified macro to run start and end of session admin, including awarding Experience Points, resetting Fortune, pausing the game and exporting the chat log.\n * TIP: Various default options can be defined in Session Management Settings under Module Settings.\n ========== */"
		},
		{
			"id": "Set Token Vision and Light",
			"name": "Establecer visión y luz de la ficha"
		},
		{
			"id": "Simply d100",
			"name": "Simplemente d100"
		},
		{
			"id": "Toggle Compendium Pack Visibility",
			"name": "Conmutar visiblidad de compendios"
		},
		{
			"id": "Toggle Scene Visibility and Light",
			"name": "Conmutar visibilidad y luz de la escena"
		}
	]
}